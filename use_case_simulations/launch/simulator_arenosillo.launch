<launch>

    <arg name="ns_prefix" default="uav_"/>

    <arg name="ual_server" default="on"/>
    <arg name="ual_pub_rate" default="30.0"/>  
    <arg name="pose_frame_id" default="map"/>
    <arg name="mavros_offboard_rate" default="30.0"/>
    <arg name="position_th" default="0.33"/>
    <arg name="orientation_th" default="0.65"/>
    <arg name="hold_pose_time" default="3.0"/>

    <!-- Launch Gazebo simulation -->
    <rosparam param="/use_sim_time">true</rosparam>
    <node pkg="px4_bringup" type="launch_gzworld.py" name="gazebo_world" output="screen"
    args="-physics=ode -world=$(find use_case_simulations)/worlds/arenosillo_trials.world
	-add_model_path=$(find use_case_simulations)/models">
	<rosparam param="sim_origin">[37.0947222, 6.7311111, 40]</rosparam> <!-- [lat,lon,alt] -->
    </node>

    <!-- Launch robot id=1 -->
    <include file="$(find px4_bringup)/launch/spawn_robot.launch" ns="ATLANTIC">
        <arg name="id" value="1"/>
        <arg name="material" value="Orange"/>
        <arg name="x" value="110"/>
        <arg name="y" value="20"/>
        <arg name="z" value="0"/>
        <arg name="yaw" value="2.5"/>
        <arg name="robot_model" value="plane"/>
    </include>

    <!-- Launch robot id=2 -->
    <!--include file="$(find px4_bringup)/launch/spawn_robot.launch" ns="SCRAB">
        <arg name="id" value="2"/>
        <arg name="material" value="Orange"/>
        <arg name="x" value="10"/>
        <arg name="y" value="0"/>
        <arg name="z" value="0"/>
        <arg name="yaw" value="0"/>
        <arg name="robot_model" value="plane"/>
    </include!-->

    <!-- Launch robot id=3 -->
    <include file="$(find px4_bringup)/launch/spawn_robot.launch" ns="M600_1">
	<arg name="id" value="3"/>
	<arg name="material" value="Orange"/>
        <arg name="robot_model" value="mbzirc"/>
        <arg name="x" value="-272"/>
        <arg name="y" value="205"/>
        <arg name="z" value="0"/>
        <arg name="yaw" value="0"/>
    </include>

    <!-- Launch robot id=4 -->
    <include file="$(find px4_bringup)/launch/spawn_robot.launch" ns="M600_2">
	<arg name="id" value="4"/>
	<arg name="material" value="Orange"/>
        <arg name="robot_model" value="mbzirc"/>
        <arg name="x" value="-80"/>
        <arg name="y" value="15"/>
        <arg name="z" value="0"/>
        <arg name="yaw" value="0"/>
    </include>

    <!-- Launch UAL server for uav id=1 -->
    <node pkg="ual_backend_mavros_fw" type="ual_backend_mavros_fw_server" name="ual" output="screen" ns="ATLANTIC">
        <param name="uav_id" value="1"/>
        <param name="ual_server" value="$(arg ual_server)"/>
        <param name="ual_pub_rate" value="$(arg ual_pub_rate)"/>
        <param name="mavros_offboard_rate" value="$(arg mavros_offboard_rate)"/>
        <param name="position_th" value="$(arg position_th)"/>
        <param name="orientation_th" value="$(arg orientation_th)"/>
        <param name="hold_pose_time" value="$(arg hold_pose_time)"/>
        <param name="pose_frame_id" value="$(arg pose_frame_id)"/>
        <param name="home_pose_parent_frame" value="map"/>
        <!-- Define home pose relative to global map frame -->
        <rosparam param="home_pose">[110, 20, 0]</rosparam><!-- [x,y,z] -->
        <!-- Define the global map frame geo position and let the UAL estimate the relative home pose -->
        <rosparam param="map_origin_geo">[37.0947222, 6.7311111, 40]</rosparam><!-- [lat,lon,alt] -->
        <rosparam param="mission/aux_distance"> 100.0</rosparam>
        <rosparam param="mission/aux_height"> 10.0</rosparam>
        <rosparam param="mission/takeoff_minimum_pitch"> 5.0</rosparam>
        <rosparam param="mission/loit_heading"> 0.0</rosparam>
        <rosparam param="mission/loit_radius"> 50.0</rosparam>
        <rosparam param="mission/loit_forward_moving"> 1.0</rosparam>
        <rosparam param="mission/land_precision_mode"> 0.0</rosparam>
        <rosparam param="mission/land_abort_alt"> 0.0</rosparam>
        <rosparam param="mission/pass_orbit_distance"> 1.0</rosparam>
        <rosparam param="mission/pass_acceptance_radius"> 30.0</rosparam>
    </node>

    <!-- Launch UAL server for uav id=2 -->
    <!--node pkg="ual_backend_mavros_fw" type="ual_backend_mavros_fw_server" name="ual" output="screen" ns="SCRAB">
        <param name="uav_id" value="2"/>
        <param name="ual_server" value="$(arg ual_server)"/>
        <param name="ual_pub_rate" value="$(arg ual_pub_rate)"/>
        <param name="mavros_offboard_rate" value="$(arg mavros_offboard_rate)"/>
        <param name="position_th" value="$(arg position_th)"/>
        <param name="orientation_th" value="$(arg orientation_th)"/>
        <param name="hold_pose_time" value="$(arg hold_pose_time)"/>
        <param name="pose_frame_id" value="$(arg pose_frame_id)"/>
        <param name="home_pose_parent_frame" value="map"/>
        <rosparam param="home_pose">[10, 0, 0]</rosparam>
        <rosparam param="map_origin_geo">[37.0947222, 6.7311111, 40]</rosparam>
        <rosparam param="mission/aux_distance"> 100.0</rosparam>
        <rosparam param="mission/aux_height"> 10.0</rosparam>
        <rosparam param="mission/takeoff_minimum_pitch"> 5.0</rosparam>
        <rosparam param="mission/loit_heading"> 0.0</rosparam>
        <rosparam param="mission/loit_radius"> 50.0</rosparam>
        <rosparam param="mission/loit_forward_moving"> 1.0</rosparam>
        <rosparam param="mission/land_precision_mode"> 0.0</rosparam>
        <rosparam param="mission/land_abort_alt"> 0.0</rosparam>
        <rosparam param="mission/pass_orbit_distance"> 1.0</rosparam>
        <rosparam param="mission/pass_acceptance_radius"> 30.0</rosparam>
    </node!-->

    <node pkg="tf" type="static_transform_publisher" name="link1_broadcaster" args="0 -150 0 0 0 0 map aux 100" />

    <!-- Launch UAL server for drone id=3 -->
    <node pkg="ual_backend_mavros" type="ual_backend_mavros_server" name="ual" output="screen" ns="M600_1">
        <param name="uav_id" value="3"/>
        <param name="pose_frame_id" value="map"/>
        <rosparam param="home_pose">[-272, 205, 0]</rosparam>
    </node>

    <!-- Launch UAL server for drone id=4 -->
    <node pkg="ual_backend_mavros" type="ual_backend_mavros_server" name="ual" output="screen" ns="M600_2">
        <param name="uav_id" value="4"/>
        <param name="pose_frame_id" value="map"/>
        <rosparam param="home_pose">[-80, 15, 0]</rosparam>
    </node>
    
</launch>
